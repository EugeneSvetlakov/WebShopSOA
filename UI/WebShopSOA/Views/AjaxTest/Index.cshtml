
@{
    ViewData["Title"] = "Ненавязчивый AJAX";
}

<div class="container">
    <h3>@ViewData["Title"]</h3>

    <div class="row">
        <div class="col-sm-4 mb-3">
            <h4>Рендеринг на стороне Сервера</h4>
            <a href="#" class="btn btn-default"
               data-ajax="true"
               data-ajax-url="@Url.Action("GetTestView", "AjaxTest", new { id = 3, msg = "Message from client." })"
               data-ajax-update="#panel-server"
               data-ajax-loading="#spiner-server">
                Загрузка
            </a>
            <span id="spiner-server" style="display:none">
                <i class="fa fa-spinner fa-spin"></i>
            </span>
            <div id="panel-server" style="min-height: 10rem"></div>
        </div>

        <div class="col-sm-4 mb-3">
            <h4>Рендеринг на стороне Клиента</h4>
            <a href="#" class="btn btn-default"
               data-ajax="true"
               data-ajax-url="@Url.Action("GetJson", "AjaxTest", new { id = 123, msg = "Hello world!" })"
               data-ajax-loading="#spiner-client"
               data-ajax-success="OnDataLoaded">
                Загрузка
            </a>
            <span id="spiner-client" style="display:none">
                <i class="fa fa-spinner fa-spin"></i>
            </span>
            
            <div id="panel-client" style="min-height: 10rem"></div>
        </div>

        <div class="col-sm-4 mb-3">
            <h4>Рендеринг с помощью java-script напрямую</h4>
            <a href="#" class="btn btn-default"
               id="load-data-button"
               data-ajax="true"
               data-ajax-loading="#spiner-js">
                Загрузка
            </a>
            <span id="spiner-js" style="display:none">
                <i class="fa fa-spinner fa-spin"></i>
            </span>
            
            <div id="panel-js" style="min-height: 10rem"></div>
        </div>
    </div>
</div>

@section Scripts{
    <script src="~/lib/jquery-ajax-unobtrusive/dist/jquery.unobtrusive-ajax.min.js"></script>

    <script>
        OnDataLoaded = data => {
            var host = $("#panel-client");
            host.empty();
            host.append("msg:" + data.message);
            host.append("</br>time:" + data.serverTime);
        }

        $("#load-data-button").click(e => {
            e.preventDefault();

            console.log("Send data to Server");

            $.get("@Url.Action("GetJson", "AjaxTest")", { id: 123, msg: "World? Hello!" })
                .done(data => {
                    const host = $("#panel-js");
                    host.empty();
                    host.append(data.message);
                    host.append("</br>");
                    host.append(data.serverTime);
                })
                .fail();
        });

    </script>
}